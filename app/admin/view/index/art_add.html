{extend name="index/base" /}
{block name="meta"}{/block}
{block name="title"}{/block}
{block name="css"}
	<link rel="stylesheet" href="/public/static/bootstrap/css/bootstrap.css">
	<link href="__STATIC__/css/common.css" rel="stylesheet">
	<link href="__STATIC__/css/admin.css" rel="stylesheet">

{/block}
{block name="common_js"}
	<script src="/public/static/js/jquery.min.js"></script>
	<script src="/public/static/bootstrap/js/bootstrap.min.js"></script>
{/block}
{block name="header"}{include file="index/header" /}{/block}
{block name="main"}
<div class="list-box" ms-controller="bbs">
	<h1 class="list-title">发布文章</h1>
	<table class="list-form" cellspacing="0">
		<thead>
			<tr>
				<td class="form-title">文章标题</td>
                <td class="form-content"><input type="text" class="input-text" ms-duplex="item.artTitle"></td>
                <td class="form-title">文章作者</td>
				<td class="form-content"><input type="text" class="input-text" ms-duplex="item.writer"></td>
            </tr>            
		</thead>
		<tbody>
            <tr>
                <td class="form-title">关  键  词</td>
                <td class="form-content"><input type="text" class="input-text" ms-duplex="item.keywords"></td>
                <td class="form-title">文章描述</td>
                <td class="form-content"><input type="text" class="input-text" ms-duplex="item.description"></td>
            </tr>
            <tr>
                <td class="form-title">类别列表</td>
                <td class="form-content"><section ms-repeat-el="cat_list"><input type="checkbox" ms-attr-checked="el.select" ms-click="makeList($index)"><span ms-text="el.name"></span></section></td>
                <td class="form-title">是否有效</td>
                <td class="form-content">
                    <select class="form-select" ms-duplex="item.dataFlag">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="form-title">是否显示</td>
                <td class="form-content">
                    <select class="form-select" ms-duplex="item.isShow">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </td>
                <td class="form-title">是否热门</td>
                <td class="form-content">
                    <select class="form-select" ms-duplex="item.isHot">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="form-title">最新项目</td>
                <td class="form-content">
                    <select class="form-select" ms-duplex="item.isNew">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </td>
                <td class="form-title">站长推荐</td>
                <td class="form-content">
                    <select class="form-select" ms-duplex="item.isTop">
                        <option value="1">是</option>
                        <option value="0">否</option>
                    </select>
                </td>
            </tr>
            <tr style="height:auto !important;">
                <td colspan="4">
                    <textarea id="editor"></textarea>
                </td>
            </tr>
            <tr>
                <td colspan="2"><button ms-click="artSave()">保存</button></td>
                <td colspan="2"><button>返回</button></td>
            </tr>
		</tbody>
	</table>
</div>
{/block}
{block name="footer"}{include file="index/footer" /}{/block}
{block name="js"}
<script src="__STATIC__/js/layer/layer.js"></script>
<script src="__STATIC__/js/avalon.js"></script>
<script src="__STATIC__/js/common.js"></script>
<script src="__STATIC__/js/logic.js"></script>
<script src="__STATIC__/js/validator.js"></script>
<script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/ueditor.all.min.js"></script>
<script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
<script>
    jQuery(document).ready(function(){
        avalon.config({
          interpolate : ["(|","|)"]
        });
        var ue = UE.getEditor('editor');
        var vm = avalon.define({
            $id:"bbs",
            item:{artId:'',artTitle:'',description:'',keywords:'',catList:'',picList:[],artText:'',writer:'',createTime:0,isShow:0,isHot:0,isNew:0,isTop:0,dataFlag:1},
            cat_list_array:[],
            cat_list:[{name:'赚钱故事',select:false,val:1},{name:"手机赚钱",select:false,val:2},{name:"电脑赚钱",select:false,val:3}],
            load:function(){
                vm.makeCatList(vm.item.catList);
            },
            makeCatList:function(str){
                for(var n=0;n<vm.cat_list.length;n++){
                    vm.cat_list[n]['select'] = false;
                }
                if(str.length == 0){
                    return;
                }
                var arr = str.split(',');
                console.log(arr);
                if(str.length > 0 && arr.length > 0){
                    for(var i=0;i<arr.length;i++){
                        for(var k=0;k<vm.cat_list.length;k++){
                            if(arr[i] == vm.cat_list[k]['val']){
                                vm.cat_list[k]['select'] = true;
                                break;
                            }
                        }
                    }
                }
            },
            makeListText:function(){
                var str = "";
                vm.item.catList = '';
                for(var i=0;i<vm.cat_list.length;i++){
                    if(vm.cat_list[i]['select'] == true){
                        str = str + vm.cat_list[i]['val'] + ",";
                    }
                }
                if(str.length > 0){
                    vm.item.catList = str.substr(0,str.length - 1);
                }else{
                    vm.item.catList = str;
                }
                console.log(vm.item.catList);
            },
            makeList:function(id){
                vm.cat_list[id]['select'] = this.checked;
            },
            artSave:function(){
                vm.makeListText();
                vm.item.artText = ue.getContent();
                console.log(vm.item);
            }
        });
        vm.load();
    });
    /*86*/
</script>

{/block}
