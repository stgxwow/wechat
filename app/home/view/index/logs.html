<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>日志列表</title>
	<link rel="stylesheet" href="__STATIC__/bootstrap/css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="__STATIC__/layui/css/layui.css" type="text/css" />
	<link rel="stylesheet" href="__STATIC__/css/font-awesome.css" type="text/css" />
	<script src="__STATIC__/js/jquery.min.js"></script>
	<link rel="stylesheet" href="__STATIC__/css/skins/skin-blue.min.css"type="text/css"/>
	<link rel="stylesheet" href="__STATIC__/css/index.css" type="text/css"/>
	<link href="__STATIC__/css/mcommon.css?v=2.0.6_180726" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" href="__STATIC__/js/datetimepicker/jquery.datetimepicker.css"/>
</head>
<body ms-controller="sub" class="hold-transition skin-blue sidebar-mini" style="display:none;" ms-visible="display">
	<div>
		<div class="alert alert-success alert-tips fade in">
			<div class="head">
				<i class="fa fa-lightbulb-o"></i>
				操作说明
			</div>
			<ul class="body">
				<li>该模块主要用于查询学员资料，在列表上面，设置有导入和导出功能，在进行导入时，需要下载相应的导入模板，并选择好项目和班级。需要注意的是,在进行学员信息批量导入时,只能够导入一次,如果有错误,需要先删除以前导入的信息才可以进行第二次导入。</li>
			</ul>
		</div>
		<div class="wst-toolbar">
			<select class="form-control" ms-duplex="where.userId">
				<option value="">请选择用户</option>
				<option ms-repeat-el="user_list" ms-attr-value="el.userId" ms-text="el.nickName"></option>
			</select>
			<select class="form-control" ms-duplex="where.logType">
				<option selected value="">请选择日志类型</option>
				<option ms-repeat-el="type_list" ms-attr-value="el" ms-text="el"></option>
            </select>
            <select class="form-control" ms-duplex="where.logModule">
				<option selected value="">请选择模块名称</option>
				<option ms-repeat-el="module_list" ms-attr-value="el" ms-text="el"></option>
			</select>
			<span class="function_input">开始日期：</span>
			<input type="text" id="date_start" class="time" style="width:10%;font-size:14px;" ms-duplex="where.logTimeStart">
			<span class="function_input">结束日期：</span>
			<input type="text" id="date_end" class="time" style="width:10%;font-size:14px;" ms-duplex="where.logTimeEnd">
			<button class="btn btn-primary" ms-click="load">查询</button>
		</div>
		<div class="wst-grid">
			<div class="mmGrid" style="width: auto; height: 275px;">
				<div class="mmg-headWrapper">
					
				</div>
				<div class="mmg-bodyWrapper">
					<div class="mmg mmg-body" style="border:1px solid #dedede;">
						<table class="mmg-head tab-list" cellspacing="0" cellpadding="0" >
							<thead style="border:0px;">
								<tr style="height:40px;line-height:40px;border-bottom:1px solid #dedede;">
									<th>序号</th>
									<th>用户姓名</th>
									<th>操作时间</th>
									<th>操作模块</th>
									<th>操作类型</th>
									<th>操作前的值</th>
									<th>操作后的值</th>
								</tr>
							</thead>
							<tbody>
								<tr cellspacing="0" ms-repeat-el="log_list">
									<td class="col-td" ms-text="$index+1"></td>
									<td class="col-td" ms-text="el.logUser"></td>
									<td class="col-td" ms-text="el.logTimeDesc"></td>
									<td class="col-td" ms-text="el.logModule"></td>
									<td class="col-td" ms-text="el.logType"></td>
									<td class="col-td" ms-text="el.logBefore"></td>
									<td class="col-td" ms-text="el.logAfter"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div id="pd" class="mmPaginator">
				<div class="totalCountLabel" ms-text="'共'+page.total+'条'"></div>
					<ul class="pageList">
						<li class="prev" ms-class="disable:page.current_page < 2" ms-click="changePage($event,parseInt(page.current_page)-1)"><a href="#">«</a></li>
						<li ms-repeat-el="page.page_item" ms-class="active:page.current_page == el" ms-click="changePage($event,el)"><a href="#" ms-text="el"></a></li>
						<li class="next" ms-click="changePage($event,parseInt(page.current_page)+1)"><a href="#">»</a></li>
					</ul>
				<div class="limit" ms-class="page.current_page >= page.total" ms-text-"'每页'+page.per_page+'条'"></div>
			</div>
		</div>
	</div>
<script src="__STATIC__/js/datetimepicker/build/jquery.datetimepicker.full.js"></script>
<script src="__STATIC__/js/layer/layer.js"></script>
<script src="__STATIC__/layui/layui.js"></script>
<script src="__STATIC__/js/avalon.js"></script>
<script src="__STATIC__/js/jquery.cookie.min.js"></script>
<script src="__STATIC__/js/jQuery.md5.js"></script>
<script src="__STATIC__/js/logic.js"></script>
<script src="__STATIC__/js/validator.js"></script>
<script src="__STATIC__/js/common.js"></script>
<script src="__STATIC__/js/ajaxfileupload.js"></script>
<script src="https://cdn.bootcss.com/require.js/2.3.6/require.js"></script>
<script>
jQuery(document).ready(function(){
	avalon.config({
		interpolate : ["(|","|)"]
	});
	$.datetimepicker.setLocale('ch');
	$('#date_start').datetimepicker(
			{
				/*theme:'dark',*/
				timepicker:true,
				format:'Y-m-d H:i',
				formatDate:'Y-m-d H:i',
				defaultTime:'00:00',
				defaultDate:new Date().Format('yyyy-MM-dd H:i'),
				onClose:function(){
					vm.where.logTimeStart = $("#date_start").val();
				}
			}
		);
		$('#date_end').datetimepicker(
			{
				/*theme:'dark',*/
				timepicker:true,
				format:'Y-m-d H:i',
				formatDate:'Y-m-d H:i',
				defaultTime:'00:00',
				defaultDate:new Date().Format('yyyy-MM-dd H:i'),
				onClose:function(){
					vm.where.logTimeEnd = $("#date_end").val();
				}
			}
		);
	layui.use(['form'], function(){});
	TX.setPageBox();
	logic_user.read();
	var vm = avalon.define({
		$id:"sub",
		display:true,
        where:{userId:'',logTimeStart:'',logTimeEnd:'',logType:'',logModule:''},
        type_list:['系统','错误','添加','编辑','删除'],
        user_list:[],
        module_list:['用户','消息','角色','项目','班级','学生','成线','课程','分组','千分制','菜单','审核','获奖','作品展示','展示分组'],
        err:{err:false,msg:""},
        log_list:[],
		page:{
			total:0,
			per_page:50,
			current_page:1,
			last_page:0,
			page_item:[]
		},		
		load:function(){
			TX.msg('努力加载中...',{time:30000});
			var vd = {
				where_userId:vm.where.$model.userId,
                where_logTimeStart:vm.where.$model.logTimeStart,
                where_logTimeEnd:vm.where.$model.logTimeEnd,
				where_logType:vm.where.$model.logType,
				where_logModule:vm.where.$model.logModule,
				page_per_page:vm.page.$model.per_page,
				page_current_page:vm.page.$model.current_page,
            };
            console.log(vd);
			$.post(logic_urls.adminLogs,vd,
				function(data){
					var json = TX.toJson(data);
					console.log(json);
					if(json.status == 1){
						layer.closeAll();
						vm.user_list = json.user_list;
						var sd = json.data;
						vm.log_list = sd.data;
						vm.page.total = sd.total;
						vm.page.per_page = sd.per_page;
						vm.current_page = sd.current_page;
						vm.page.last_page = sd.last_page;
						vm.page.page_item = [];
						for(var i=1;i<=vm.page.last_page;i++){
							vm.page.page_item.push(i);
						}
						avalon.scan();
					}else{
						TX.msg(json.msg,{time:5000});
					}
				}
			);
		},
		changePage:function(e,p){
			e.preventDefault();
			var num = vm.page.last_page;
			if(p >=1 && p <=num){
				vm.page.current_page = p;
				vm.load();
			}
		},

	});
	vm.load();
});
</script>
</body>
</html>